{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "stream-chat-history",
  "type": "registry:block",
  "description": "Stream chat history component",
  "dependencies": [
    "@mdi/js"
  ],
  "files": [
    {
      "path": "registry/new-york/stream/blocks/stream-chat-history/chat-history.tsx",
      "content": "\"use client\"\n\nimport { useCallback, useEffect, useState } from \"react\"\nimport { mdiChatOutline, mdiTrashCanOutline } from \"@mdi/js\"\nimport { chat as chatApi, HTTPError } from \"@sitecore/stream-ui-core\"\nimport { useSetAtom } from \"jotai\"\nimport { omit } from \"lodash\"\nimport { flushSync } from \"react-dom\"\nimport { toast } from \"sonner\"\n\nimport { Button } from \"@/registry/new-york/ui/button\"\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/registry/new-york/ui/dialog\"\n\nimport { useGetChats } from \"../../hooks/use-get-chats\"\nimport { cn } from \"../../lib/utils\"\nimport { useChatProvider } from \"../chat/hooks/useChatProvider\"\nimport { Icon } from \"../chat/Icon\"\nimport { apiQueueAtom } from \"../chat/store/atoms\"\n\ninterface ChatItem {\n  id: string\n  title: string\n  disabled: boolean\n}\n\nexport type ChatHistoryProps = {\n  className?: string\n  onChatClick?: (chat: ChatItem) => void\n  onChatDelete?: (chat: ChatItem) => void\n  disabled?: boolean\n  refetch?: boolean\n}\n\n/**\n * Renders a chat history list with clickable chat items and delete buttons.\n *\n * @param {Object} props The properties for the ChatHistory component.\n * @param {string} props.className Optional additional class names for the container.\n * @param {Array} props.chats An array of chat objects to be displayed. Each chat object should include `id`, `title`, and `disabled` properties.\n * @param {Function} [props.onChatClick] A callback function invoked when a chat item is clicked. Receives the clicked chat object as a parameter.\n * @param {Function} [props.onChatDelete] A callback function invoked when the delete button for a chat is clicked. Receives the chat object to be deleted as a parameter.\n * @return {JSX.Element} The rendered ChatHistory component.\n */\nexport function ChatHistory(props: ChatHistoryProps) {\n  const { className, onChatClick, onChatDelete, disabled, refetch } = props\n\n  /* Hooks */\n  const { session } = useChatProvider()\n  const [deletedChat, setDeletedChat] = useState<ChatItem | null>(null)\n  const [isDeleting, setIsDeleting] = useState(false)\n  const [isDeleteChatModalOpen, setIsDeleteChatModalOpen] = useState(false)\n  const getChats = useGetChats(session.orgId, session.userId)\n  const [_chats, setChats] = useState<ChatItem[]>([])\n\n  /* Atoms */\n  const setApiQueue = useSetAtom(apiQueueAtom)\n\n  async function handleDeleteChatOnDelete(chat: ChatItem) {\n    setIsDeleting(true)\n    setApiQueue((prev) => ({ ...prev, [`removeChat_${chat?.id}`]: chat?.id }))\n\n    try {\n      await chatApi.deleteUserChatApiChatsV1OrganizationsOrganizationIdUsersUserIdChatsChatIdDelete(\n        {\n          path: {\n            userId: session.userId,\n            chatId: chat.id,\n            organizationId: session.orgId,\n          },\n        }\n      )\n\n      setDeletedChat(null)\n      setIsDeleteChatModalOpen(false)\n      flushSync(() => {\n        onChatDelete?.(chat)\n      })\n\n      toast.success(\"Chat deleted successfully\")\n\n      await fetchChats()\n    } catch (error: unknown) {\n      const { response } = error as HTTPError\n      const { detail } = (await response.json()) as {\n        type: string\n        detail: string\n      }\n      toast.error(detail)\n    } finally {\n      setIsDeleting(false)\n      setApiQueue((prev) => omit(prev, [`removeChat_${chat?.id}`]))\n    }\n  }\n\n  const fetchChats = useCallback(\n    async function () {\n      try {\n        const data = await getChats()\n        setChats(data as unknown as ChatItem[])\n      } catch (error: unknown) {\n        const { response } = error as HTTPError\n        const { detail } = (await response.json()) as {\n          type: string\n          detail: string\n        }\n        toast.error(detail)\n      }\n    },\n    [getChats]\n  )\n\n  /* Init */\n  useEffect(() => {\n    fetchChats()\n  }, [fetchChats])\n\n  useEffect(() => {\n    if (refetch) fetchChats()\n  }, [fetchChats, refetch])\n\n  return (\n    <div className={cn(\"flex w-64 flex-col gap-1\", className)}>\n      {_chats\n        ?.map((chat) => ({ ...chat, disabled }) as ChatItem)\n        .map((chat) => (\n          <div\n            key={chat.id}\n            aria-disabled={chat.disabled}\n            className={cn(\n              \"group flex min-h-10 items-center justify-between gap-2 rounded px-2 py-1 transition-colors\",\n              {\n                \"cursor-pointer hover:bg-purple-100\": !chat.disabled,\n                \"cursor-not-allowed opacity-50\": chat.disabled,\n              }\n            )}\n            onClick={() => {\n              if (chat.disabled) return\n              onChatClick?.(chat)\n            }}\n          >\n            <div className=\"flex min-w-0 items-center gap-2\">\n              <Icon path={mdiChatOutline} className=\"size-6 text-gray-500\" />\n              <h2 className=\"text-md min-w-0 truncate\">{chat.title}</h2>\n            </div>\n            <button\n              disabled={chat.disabled}\n              className={cn(\"hidden\", {\n                \"cursor-pointer group-hover:block\": !chat.disabled,\n                \"cursor-not-allowed\": chat.disabled,\n              })}\n              onClick={(e) => {\n                e.stopPropagation()\n                if (chat.disabled) return\n                setDeletedChat(chat)\n                setIsDeleteChatModalOpen(true)\n              }}\n            >\n              <Icon\n                path={mdiTrashCanOutline}\n                className=\"size-8 rounded-full p-1 text-gray-500 hover:bg-purple-300\"\n              />\n            </button>\n          </div>\n        ))}\n      <Dialog\n        open={isDeleteChatModalOpen}\n        onOpenChange={setIsDeleteChatModalOpen}\n      >\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle className=\"body-text text-xl\">Delete Chat</DialogTitle>\n          </DialogHeader>\n          <p className=\"text-md py-5 font-normal\">\n            Are you sure you want to delete this chat? This action cannot be\n            undone.\n          </p>\n          <DialogFooter>\n            <Button\n              variant=\"ghost\"\n              colorScheme=\"neutral\"\n              onClick={() => {\n                setDeletedChat(null)\n                setIsDeleteChatModalOpen(false)\n              }}\n            >\n              Cancel\n            </Button>\n            <Button\n              disabled={isDeleting}\n              colorScheme=\"danger\"\n              onClick={() => handleDeleteChatOnDelete(deletedChat as ChatItem)}\n            >\n              Delete\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n",
      "type": "registry:component",
      "target": "components/stream-components/blocks/stream-chat-history/chat-history.tsx"
    },
    {
      "path": "registry/new-york/stream/blocks/stream-chat-history/page.tsx",
      "content": "import { ChatHistory } from \"./chat-history\"\n\nexport default function StreamChatHistoryPage() {\n  return (\n    <div className=\"container mx-auto space-y-6 p-6\">\n      <div className=\"space-y-2\">\n        <h1 className=\"text-2xl font-bold\">Stream Chat History</h1>\n        <p className=\"text-muted-foreground\">\n          A component for displaying a list of chat conversations with actions.\n        </p>\n      </div>\n      <div className=\"space-y-4\">\n        <ChatHistory\n          onChatClick={(chat) => alert(`Clicked: ${chat.title}`)}\n          onChatDelete={(chat) => alert(`Deleted: ${chat.title}`)}\n        />\n      </div>\n    </div>\n  )\n}\n",
      "type": "registry:page",
      "target": "app/blocks/stream-chat-history/page.tsx"
    }
  ],
  "categories": [
    "stream",
    "ui",
    "chat",
    "history"
  ]
}